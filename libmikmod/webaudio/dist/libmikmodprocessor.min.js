'use strict';var LibMikModMessageId;(function(b){b[b.INIT=1]="INIT";b[b.CHECK_STATUS=2]="CHECK_STATUS";b[b.LOAD_MODULE_BUFFER=3]="LOAD_MODULE_BUFFER";b[b.CHANGE_GENERAL_OPTIONS=4]="CHANGE_GENERAL_OPTIONS";b[b.STOP_MODULE=5]="STOP_MODULE";b[b.PLAYBACK_ENDED=6]="PLAYBACK_ENDED";b[b.GET_ID=7]="GET_ID"})(LibMikModMessageId||(LibMikModMessageId={}));"use strict";
class LibMikMod{static init(b){return LibMikMod.loaded?Promise.resolve():new Promise((e,f)=>{LibMikMod.loading?f("Still loading"):LibMikMod.loadError?f("Error loading the library"):(LibMikMod.loading=!0,LibMikModCLib({wasmBinary:b}).then(g=>{LibMikMod.cLib=g;(g=g._init())?(LibMikMod.loading=!1,LibMikMod.loadError=!0,f(g)):(LibMikMod.loading=!1,LibMikMod.loaded=!0,e())},g=>{LibMikMod.loading=!1;LibMikMod.loadError=!0;f(g)}))})}static terminate(){LibMikMod.cLib&&(LibMikMod.cLib._terminate(),LibMikMod.cLib=
null,LibMikMod.audioBufferPtr=0,LibMikMod.audioBufferUsedLength=0)}static loadModule(b,e,f){if(!LibMikMod.cLib)return 3;if(!e)return 2;var g=LibMikMod.cLib._preLoadModule(e.byteLength);if(!g)return 2;g=new Uint8Array(LibMikMod.cLib.HEAP8.buffer,g,e.byteLength);"set"in e?g.set(e,0):g.set(new Uint8Array(e,0,e.byteLength),0);LibMikMod.audioBufferPtr=0;LibMikMod.audioBufferUsedLength=0;f&&(void 0!==f.reverb&&0<=f.reverb&&15>=f.reverb&&(LibMikMod.lastReverb=f.reverb),void 0!==f.hqMixer&&(LibMikMod.lastHqMixer=
f.hqMixer?1:0),void 0!==f.interpolation&&(LibMikMod.lastInterpolation=f.interpolation?1:0),void 0!==f.noiseReduction&&(LibMikMod.lastNoiseReduction=f.noiseReduction?1:0),void 0!==f.wrap&&(LibMikMod.lastWrap=f.wrap?1:0),void 0!==f.loop&&(LibMikMod.lastLoop=f.loop?1:0),void 0!==f.fadeout&&(LibMikMod.lastFadeout=f.fadeout?1:0));return(b=LibMikMod.cLib._loadModule(b,LibMikMod.lastReverb,LibMikMod.lastHqMixer,LibMikMod.lastInterpolation,LibMikMod.lastNoiseReduction,LibMikMod.lastWrap,LibMikMod.lastLoop,
LibMikMod.lastFadeout))||LibMikMod.cLib._getAudioBuffer()?b:2}static changeGeneralOptions(b){b&&(void 0!==b.reverb&&0<=b.reverb&&15>=b.reverb&&(LibMikMod.lastReverb=b.reverb),void 0!==b.interpolation&&(LibMikMod.lastInterpolation=b.interpolation?1:0),void 0!==b.noiseReduction&&(LibMikMod.lastNoiseReduction=b.noiseReduction?1:0),LibMikMod.cLib&&LibMikMod.cLib._changeGeneralOptions(LibMikMod.lastReverb,LibMikMod.lastInterpolation,LibMikMod.lastNoiseReduction))}static stopModule(){LibMikMod.cLib&&(LibMikMod.cLib._freeModule(),
LibMikMod.audioBufferPtr=0,LibMikMod.audioBufferUsedLength=0)}static getString(b,e){if(LibMikMod.cLib&&b){if(!e)return"";const f=Array(e),g=LibMikMod.cLib.HEAP8;for(;0<e--;)f[e]=g[b+e];return String.fromCharCode.apply(String,f)}return null}static getSongName(){return LibMikMod.cLib?LibMikMod.getString(LibMikMod.cLib._getSongName(),LibMikMod.cLib._getSongNameLength()):null}static getModType(){return LibMikMod.cLib?LibMikMod.getString(LibMikMod.cLib._getModType(),LibMikMod.cLib._getModTypeLength()):
null}static getComment(){return LibMikMod.cLib?LibMikMod.getString(LibMikMod.cLib._getComment(),LibMikMod.cLib._getCommentLength()):null}static process(b){if(!LibMikMod.cLib)return!1;let e=LibMikMod.audioBufferUsedLength;if(!e){for(var f=0;3>f;f++){e=LibMikMod.cLib._update();if(0>e)return!1;if(e){LibMikMod.audioBufferPtr=LibMikMod.cLib._getAudioBuffer();LibMikMod.audioBufferUsedLength=e;break}}if(!e)return!0}var g=null;for(f=b.length-1;0<=f;f--){const u=b[f];for(let r=u.length-1;0<=r;r--){const v=
u[r];g||(g=v.length<<2,e>g&&(e=g),g=new Float32Array(LibMikMod.cLib.HEAP8.buffer,LibMikMod.audioBufferPtr,e>>2),LibMikMod.audioBufferPtr+=e,LibMikMod.audioBufferUsedLength-=e);v.set(g)}}return!0}}LibMikMod.cLib=null;LibMikMod.audioBufferPtr=0;LibMikMod.audioBufferUsedLength=0;LibMikMod.lastReverb=0;LibMikMod.lastHqMixer=1;LibMikMod.lastInterpolation=1;LibMikMod.lastNoiseReduction=1;LibMikMod.lastWrap=0;LibMikMod.lastLoop=0;LibMikMod.lastFadeout=1;LibMikMod.loading=!1;LibMikMod.loaded=!1;
LibMikMod.loadError=!1;"use strict";
class LibMikModProcessor extends AudioWorkletProcessor{constructor(){super();this.ended=!1;this.id=++LibMikModProcessor.currentId;this.port.onmessage=this.handleMessage.bind(this)}postResponse(b){this.id==LibMikModProcessor.currentId&&this.port.postMessage(b)}handleMessage(b){if(b=b.data)switch(b.messageId){case LibMikModMessageId.INIT:LibMikMod.loaded||LibMikMod.loading||LibMikMod.loadError||!b.buffer||LibMikMod.init(b.buffer).then(()=>{this.postResponse({id:this.id,messageId:LibMikModMessageId.INIT})},
()=>{this.postResponse({id:this.id,messageId:LibMikModMessageId.INIT})});break;case LibMikModMessageId.CHECK_STATUS:b.id===this.id&&this.postResponse({id:this.id,messageId:LibMikModMessageId.CHECK_STATUS,loading:LibMikMod.loading,loaded:LibMikMod.loaded,loadError:LibMikMod.loadError});break;case LibMikModMessageId.LOAD_MODULE_BUFFER:b.id===this.id&&((b=LibMikMod.loadModule(sampleRate,b.buffer,b.options))?this.postResponse({id:this.id,messageId:LibMikModMessageId.LOAD_MODULE_BUFFER,result:b}):this.postResponse({id:this.id,
messageId:LibMikModMessageId.LOAD_MODULE_BUFFER,result:b,infoSongName:LibMikMod.getSongName(),infoModType:LibMikMod.getModType(),infoComment:LibMikMod.getComment()}));break;case LibMikModMessageId.CHANGE_GENERAL_OPTIONS:LibMikMod.changeGeneralOptions(b.options);break;case LibMikModMessageId.STOP_MODULE:b.id!==this.id||this.ended||(this.ended=!0,LibMikMod.stopModule());break;case LibMikModMessageId.GET_ID:this.postResponse({id:this.id,messageId:LibMikModMessageId.GET_ID})}}process(b,e,f){return this.id!=
LibMikModProcessor.currentId||this.ended?!1:LibMikMod.process(e)?!0:(this.ended||(this.ended=!0,LibMikMod.stopModule(),this.postResponse({id:this.id,messageId:LibMikModMessageId.PLAYBACK_ENDED})),!1)}}LibMikModProcessor.currentId=0;registerProcessor("libmikmodprocessor",LibMikModProcessor);
var LibMikModCLib=function(){var b="undefined"!==typeof document&&document.currentScript?document.currentScript.src:void 0;return function(e){function f(c){return a.locateFile?a.locateFile(c,n):n+c}function g(c,d){0<c%d&&(c+=d-c%d);return c}function u(c){L=c;a.HEAP8=new Int8Array(c);a.HEAP16=new Int16Array(c);a.HEAP32=new Int32Array(c);a.HEAPU8=D=new Uint8Array(c);a.HEAPU16=new Uint16Array(c);a.HEAPU32=new Uint32Array(c);a.HEAPF32=new Float32Array(c);a.HEAPF64=new Float64Array(c)}function r(c){if(a.onAbort)a.onAbort(c);
c+="";w(c);M=!0;c=new WebAssembly.RuntimeError("abort("+c+"). Build with -s ASSERTIONS=1 for more info.");E(c);throw c;}function v(c){try{if(c==m&&x)return new Uint8Array(x);if(F)return F(c);throw"both async and sync fetching of the wasm failed";}catch(d){r(d)}}function S(){if(!x&&(G||y)){if("function"===typeof fetch&&!m.startsWith("file://"))return fetch(m,{credentials:"same-origin"}).then(function(c){if(!c.ok)throw"failed to load wasm binary file at '"+m+"'";return c.arrayBuffer()}).catch(function(){return v(m)});
if(N)return new Promise(function(c,d){N(m,function(k){c(new Uint8Array(k))},d)})}return Promise.resolve().then(function(){return v(m)})}function H(c){for(;0<c.length;){var d=c.shift();if("function"==typeof d)d(a);else{var k=d.func;"number"===typeof k?void 0===d.arg?I.get(k)():I.get(k)(d.arg):k(void 0===d.arg?null:d.arg)}}}function J(c){function d(){if(!B&&(B=!0,a.calledRun=!0,!M)){H(O);P(a);if(a.onRuntimeInitialized)a.onRuntimeInitialized();if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=
[a.postRun]);a.postRun.length;)Q.unshift(a.postRun.shift());H(Q)}}if(!(0<t)){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)R.unshift(a.preRun.shift());H(R);0<t||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1);d()},1)):d())}}e=e||{};var a="undefined"!==typeof e?e:{},P,E;a.ready=new Promise(function(c,d){P=c;E=d});var z={},p;for(p in a)a.hasOwnProperty(p)&&(z[p]=a[p]);var G=!1,y=!1;G="object"===typeof window;
y="function"===typeof importScripts;var n="",F;if(G||y){y?n=self.location.href:"undefined"!==typeof document&&document.currentScript&&(n=document.currentScript.src);b&&(n=b);n=0!==n.indexOf("blob:")?n.substr(0,n.lastIndexOf("/")+1):"";y&&(F=function(c){var d=new XMLHttpRequest;d.open("GET",c,!1);d.responseType="arraybuffer";d.send(null);return new Uint8Array(d.response)});var N=function(c,d,k){var h=new XMLHttpRequest;h.open("GET",c,!0);h.responseType="arraybuffer";h.onload=function(){200==h.status||
0==h.status&&h.response?d(h.response):k()};h.onerror=k;h.send(null)}}a.print||console.log.bind(console);var w=a.printErr||console.warn.bind(console);for(p in z)z.hasOwnProperty(p)&&(a[p]=z[p]);z=null;var x;a.wasmBinary&&(x=a.wasmBinary);"object"!==typeof WebAssembly&&r("no native wasm support detected");var C,M=!1,L,D,I,R=[],O=[],Q=[],t=0,K=null,A=null;a.preloadedImages={};a.preloadedAudios={};var m="libmikmodclib.wasm";m.startsWith("data:application/octet-stream;base64,")||(m=f(m));var T={a:function(c,
d,k){D.copyWithin(c,d,d+k)},b:function(c){var d=D.length;c>>>=0;if(33554432<c)return!1;for(var k=1;4>=k;k*=2){var h=d*(1+.2/k);h=Math.min(h,c+100663296);h=Math.min(33554432,g(Math.max(c,h),65536));a:{try{C.grow(h-L.byteLength+65535>>>16);u(C.buffer);var l=1;break a}catch(q){}l=void 0}if(l)return!0}return!1}};(function(){function c(l,q){a.asm=l.exports;C=a.asm.c;u(C.buffer);I=a.asm.e;O.unshift(a.asm.d);t--;a.monitorRunDependencies&&a.monitorRunDependencies(t);0==t&&(null!==K&&(clearInterval(K),K=null),
A&&(l=A,A=null,l()))}function d(l){c(l.instance)}function k(l){return S().then(function(q){return WebAssembly.instantiate(q,h)}).then(l,function(q){w("failed to asynchronously prepare wasm: "+q);r(q)})}var h={a:T};t++;a.monitorRunDependencies&&a.monitorRunDependencies(t);if(a.instantiateWasm)try{return a.instantiateWasm(h,c)}catch(l){return w("Module.instantiateWasm callback failed with error: "+l),!1}(function(){return x||"function"!==typeof WebAssembly.instantiateStreaming||m.startsWith("data:application/octet-stream;base64,")||
m.startsWith("file://")||"function"!==typeof fetch?k(d):fetch(m,{credentials:"same-origin"}).then(function(l){return WebAssembly.instantiateStreaming(l,h).then(d,function(q){w("wasm streaming compile failed: "+q);w("falling back to ArrayBuffer instantiation");return k(d)})})})().catch(E);return{}})();a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.d).apply(null,arguments)};a._getAudioBuffer=function(){return(a._getAudioBuffer=a.asm.f).apply(null,arguments)};a._getAudioBufferMaxLength=
function(){return(a._getAudioBufferMaxLength=a.asm.g).apply(null,arguments)};a._getAudioBufferUsedLength=function(){return(a._getAudioBufferUsedLength=a.asm.h).apply(null,arguments)};a._init=function(){return(a._init=a.asm.i).apply(null,arguments)};a._freeModule=function(){return(a._freeModule=a.asm.j).apply(null,arguments)};a._terminate=function(){return(a._terminate=a.asm.k).apply(null,arguments)};a._preLoadModule=function(){return(a._preLoadModule=a.asm.l).apply(null,arguments)};a._loadModule=
function(){return(a._loadModule=a.asm.m).apply(null,arguments)};a._changeGeneralOptions=function(){return(a._changeGeneralOptions=a.asm.n).apply(null,arguments)};a._update=function(){return(a._update=a.asm.o).apply(null,arguments)};a._getSongName=function(){return(a._getSongName=a.asm.p).apply(null,arguments)};a._getSongNameLength=function(){return(a._getSongNameLength=a.asm.q).apply(null,arguments)};a._getModType=function(){return(a._getModType=a.asm.r).apply(null,arguments)};a._getModTypeLength=
function(){return(a._getModTypeLength=a.asm.s).apply(null,arguments)};a._getComment=function(){return(a._getComment=a.asm.t).apply(null,arguments)};a._getCommentLength=function(){return(a._getCommentLength=a.asm.u).apply(null,arguments)};var B;A=function d(){B||J();B||(A=d)};a.run=J;if(a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();J();return e.ready}}();
"object"===typeof exports&&"object"===typeof module?module.exports=LibMikModCLib:"function"===typeof define&&define.amd?define([],function(){return LibMikModCLib}):"object"===typeof exports&&(exports.LibMikModCLib=LibMikModCLib);
